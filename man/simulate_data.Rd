% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/simulate.R, R/simulate_data.R
\name{simulate_data}
\alias{simulate_data}
\alias{as_vcov}
\title{Create Simulated Datasets}
\usage{
simulate_data(pars_c, pars_t, post_ice_traj, strategies = getStrategies())

as_vcov(sd, cor)

simulate_data(pars_c, pars_t, post_ice_traj, strategies = getStrategies())
}
\arguments{
\item{pars_c}{A \code{simul_pars} object as generated by \code{\link[=set_simul_pars]{set_simul_pars()}}. It specifies the simulation parameters of the control arm.}

\item{pars_t}{A \code{simul_pars} object as generated by \code{\link[=set_simul_pars]{set_simul_pars()}}. It specifies the simulation parameters of the treatment arm.}

\item{post_ice_traj}{Character that specifies the assumption about post-ICE1 outcomes.
Must target a function included in \code{strategies}. Possible choices are: Missing At Random \code{"MAR"}, Jump to Reference \code{"JR"},
Copy Reference \code{"CR"}, Copy Increments in Reference \code{"CIR"}, Last Mean Carried Forward \code{"LMCF"}. User-defined strategies
could also be added. See \code{\link[=getStrategies]{getStrategies()}} for details.}

\item{strategies}{A named list of functions. Default equal to \code{\link[=getStrategies]{getStrategies()}}. See \code{\link[=getStrategies]{getStrategies()}} for details.}

\item{sd}{the standard deviations for the outcome at each visit.
i.e. the square root of the diagonal of the covariance matrix for the outcome}

\item{cor}{the correlation coefficients between the outcome values at each visit.
See details.}

\item{n}{the number of subjects to sample. Total number of observations returned
is thus \code{n * length(sd)}}

\item{mu}{the coefficients to use to construct the mean outcome value at each visit. Must
be a named list with elements \code{int}, \code{age}, \code{sex}, \code{trt} & \code{visit}. See details.}
}
\value{
A \code{data.frame} containing the simulated data. It includes the following variables:
\itemize{
\item \code{id}: Factor variable that specifies the id of each subject.
\item \code{visit}: Factor variable that specifies the visit of each assessment. Visit \code{0} denotes the baseline visit.
\item \code{group}: Factor variable that specifies which treatment group each subject belongs to.
\item \code{out_bl}: Numeric variable that specifies the baseline outcome.
\item \code{out_noICE}: Numeric variable that specifies the longitudinal outcome assuming no ICEs.
\item \code{ind_ice1}: Binary variable that takes value \code{1} if the corresponding visit is affected by ICE1 and \code{0} otherwise.
\item \code{dropout_ice1}: Binary variable that takes value \code{1} if the corresponding visit is affected by the drop-out following ICE1 and \code{0} otherwise.
\item \code{out_ice1}: Numeric variable that specifies the longitudinal outcome including ICE1.
\item \code{dropout2}: Binary variable that takes value \code{1} if the corresponding visit is affected by the uninformative study drop-out.
\item \code{ind_ice2}: Binary variable that takes value \code{1} if the corresponding visit is affected by ICE2.
\item \code{outcome}: Numeric variable that specifies the longitudinal outcome including ICE1, ICE2 and the intermittent missing values.
}
}
\description{
Creates a longitudinal dataset in the format that rbmi was
designed to analyse.

Generate data for a two-arms clinical trial with longitudinal continuous outcome and two intercurrent events (ICEs).
}
\details{
The number of visits is determined by the size of the variance covariance matrix.
i.e. if 3 standard deviation values are provided then 3 visits per patient will be
created.

The covariates in the simulated dataset are produced as follows:
\itemize{
\item Patients age is sampled at random from a N(0,1) distribution
\item Patients sex is sampled at random with a 50/50 split
\item Patients group is sampled at random but fixed so that each group has \code{n/2} patients
\item The outcome variable is sampled from a multivariate normal distribution, see below
for details
}

The mean for the outcome variable is derived as:\preformatted{outcome = Intercept + age + sex + visit + treatment
}

The coefficients for the intercept, age and sex are taken from \code{mu$int},
\code{mu$age} and \code{mu$sex} respectively, all of which must be a length 1 numeric.

Treatment and visit coefficients are taken from \code{mu$trt} and \code{mu$visit} respectively
and must either be of length 1 (i.e. a constant affect across all visits) or equal to the
number of visits (as determined by the length of \code{sd}). I.e. if you wanted a treatment
slope of 5 and a visit slope of 1 you could specify:\preformatted{mu = list(..., "trt" = c(0,5,10), "visit" = c(0,1,2))
}

The correlation matrix is constructed from \code{cor} as follows.
Let \code{cor = c(a, b, c, d, e, f)} then the correlation matrix would be:\preformatted{1  a  b  d
a  1  c  e
b  c  1  f
d  e  f  1
}

The data generation works as follows:
\itemize{
\item Generate data from a multivariate normal distribution with parameters \code{pars_c$mu} and \code{pars_c$sigma}
for the control arm and parameters \code{pars_t$mu} and \code{pars_t$sigma} for the treatment arm.
\item Simulate ICE1 according to the given logistic model for the probability of ICE1. ICE1 could often represent treatment discontinuation due to study-related events.
\item Simulate drop-out following ICE1 according to \code{pars_c$prob_post_ice1_dropout} and \code{pars_t$prob_post_ice1_dropout}. This drop-out is conditional on ICE1 and is simulated completely at random.
\item Simulate an additional uninformative study drop-out with probabilities \code{pars_c$prob_dropout} and \code{pars_t$prob_dropout} at each visit.
The simulated time of drop-out is the subject's first visit which is affected by drop-out and data from this visit and all subsequent visits are consequently set to missing.
In addition, in case the subject is still on treatment at the subject's (first) visit affected drop-out,
then dropout also triggers discontinuation of study drug and a corresponding ICE called "ICE2" is generated. ICE2 could often represent treatment discontinuation
due to events not related to the study.
\item Adjust trajectories after the ICEs according to the given assumption expressed with the \code{post_ice_traj} argument.
}

The model for the probability of experiencing ICE1 is:
\code{~ 1 + I(visit == 0) + ... + I(visit == n_visits-1) + I((x-alpha))} where:
\itemize{
\item \code{n_visits} is the number of visits (including baseline).
\item \code{alpha = mu_c[1]} or \code{alpha = mu_t[1]}: \code{alpha} is the baseline outcome mean in the control arm if the subject belongs to the control arm. Otherwise it is the baseline outcome mean in the treatment arm.
The term \code{I((x-alpha))} specifies the dependency of the probability of ICE1 on the current outcome value.
The corresponding coefficient is \code{log(pars_c$or_outcome_ice1)} (or \code{log(pars_t$or_outcome_ice1)}) which represents the increase of the ICE1 probability
due to a +1 higher value of the outcome at the visit. \code{pars_c$or_outcome_ice1} and \code{pars_t$or_outcome_ice1} are the odds ratio corresponding to such increase in the outcome for the two groups.
}

Please note that the baseline outcome cannot be missing nor be affected by any ICEs.
}
